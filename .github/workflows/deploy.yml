- name: Create or Update EB Environment
  run: |
    APP_NAME="Sample-AUTH-API"
    ENV_NAME="development"
    VERSION_LABEL="${{ env.VERSION_LABEL }}"
    PLATFORM_ARN="${{ env.PLATFORM_ARN }}"

    ENV_EXISTS=$(aws elasticbeanstalk describe-environments \
      --application-name "$APP_NAME" \
      --environment-names "$ENV_NAME" \
      --query "Environments[0].EnvironmentName" \
      --output text 2>/dev/null)

    if [ -z "$ENV_EXISTS" ] || [ "$ENV_EXISTS" = "None" ]; then
      echo "Creating EB environment..."
      aws elasticbeanstalk create-environment \
        --application-name "$APP_NAME" \
        --environment-name "$ENV_NAME" \
        --platform-arn "$PLATFORM_ARN" \
        --version-label "$VERSION_LABEL"
    else
      echo "Updating EB environment..."
      aws elasticbeanstalk update-environment \
        --environment-name "$ENV_NAME" \
        --version-label "$VERSION_LABEL"
    fi